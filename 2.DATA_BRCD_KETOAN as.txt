insert into DATA_BRCD_KETOAN as
select * from (select 202510 thang,a.phanvung_id,a.LOAITB_ID,a.LOAIHINH_TB,a.khoanmuctt_id, a.MA_GD, a.HDTB_ID, a.THUEBAO_ID, a.MA_TB,c.ten_kh, a.MA_LOAIHD, a.TEN_LOAIHD, a.TEN_KIEULD, a.NGAY_YC, a.NGAY_HT, a.TEN_NV, a.TEN_DV, a.PBH, a.DONVI_TT_ID, a.TEN_PB_TTVT, a.NGAY_TT, a.NGAY_HD, a.SERI, a.SOSERI, a.TIEN, a.VAT
        ,a.TIEN+a.VAT tong_ps,
         (CASE
                    WHEN 
                         ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_trong_thang,
                (CASE
                    WHEN 
                         ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_trong_thang,
                (CASE
                    WHEN 
                        ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_trong_thang
                ,
                (CASE
                    WHEN ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510 and trangthai= 1)

                    THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_thang_truoc,
                (CASE
                    WHEN ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510 and trangthai= 1)

                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_thang_truoc,
                (CASE
                    WHEN 
                        ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510  and trangthai= 1)

                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_thang_truoc
                ,
                 (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                        THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_chua_thu,
                (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_chua_thu,
                (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_chua_thu,
        a.KM_LAPDAT, a.VAT_KM, a.HT_TRA,  a.KENHTHU, a.TRANGTHAI_TT, a.TENCHUQUAN--, a.CHUQUAN_ID 
        from  vietanhvh.onebss_202510_new a
        left join css.v_db_thuebao@dataguard_VTU b on a.thuebao_id = b.thuebao_id and b.phanvung_id = a.phanvung_id
        left join css.v_db_khachhang@dataguard_VTU c on b.KHACHHANG_ID =c.KHACHHANG_ID  and c.phanvung_id = a.phanvung_id
        where  a.khoanmuctt_id  in (1,2,3,4,9,17,29) and a.phanvung_id = 2
                and a.tthd_id = 6 and a.dichvuvt_id in (1,4,7,8,9,10,11,12)
                and hdtb_id not in (select hdtb_id from css.v_hdtb_dungthu@dataguard_VTU 
                                    where (to_char(NGAY_BD,'yyyymm'))= 202510 and trangthai <> 0 
                                            and (to_char(NGAY_CHUYEN,'yyyymm'))= 202510
                )
                )
                ;
                insert into DATA_BRCD_KETOAN
select * from (select 202510 thang,a.phanvung_id,a.LOAITB_ID,a.LOAIHINH_TB,a.khoanmuctt_id, a.MA_GD, a.HDTB_ID, a.THUEBAO_ID, a.MA_TB,c.ten_kh, a.MA_LOAIHD, a.TEN_LOAIHD, a.TEN_KIEULD, a.NGAY_YC, a.NGAY_HT, a.TEN_NV, a.TEN_DV, a.PBH, a.DONVI_TT_ID, a.TEN_PB_TTVT, a.NGAY_TT, a.NGAY_HD, a.SERI, a.SOSERI, a.TIEN, a.VAT
        ,a.TIEN+a.VAT tong_ps,
         (CASE
                    WHEN 
                         ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_trong_thang,
                (CASE
                    WHEN 
                         ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_trong_thang,
                (CASE
                    WHEN 
                        ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_trong_thang
                ,
                (CASE
                    WHEN ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510 and trangthai= 1)

                    THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_thang_truoc,
                (CASE
                    WHEN ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510 and trangthai= 1)

                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_thang_truoc,
                (CASE
                    WHEN 
                        ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510  and trangthai= 1)

                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_thang_truoc
                ,
                 (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                        THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_chua_thu,
                (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_chua_thu,
                (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_chua_thu,
        a.KM_LAPDAT, a.VAT_KM, a.HT_TRA,  a.KENHTHU, a.TRANGTHAI_TT, a.TENCHUQUAN--, a.CHUQUAN_ID 
        from  vietanhvh.onebss_202510_new a
        left join css.v_db_thuebao@dataguard_BDG b on a.thuebao_id = b.thuebao_id and b.phanvung_id = a.phanvung_id
        left join css.v_db_khachhang@dataguard_BDG c on b.KHACHHANG_ID =c.KHACHHANG_ID  and c.phanvung_id = a.phanvung_id
        where  a.khoanmuctt_id  in (1,2,3,4,9,17,29) and a.phanvung_id = 8
                and a.tthd_id = 6 and a.dichvuvt_id in (1,4,7,8,9,10,11,12)
                and hdtb_id not in (select hdtb_id from css.v_hdtb_dungthu@dataguard_BDG 
                                    where (to_char(NGAY_BD,'yyyymm'))= 202510 and trangthai <> 0 
                                            and (to_char(NGAY_CHUYEN,'yyyymm'))= 202510
                )
                )
                ;
                      insert into DATA_BRCD_KETOAN
                      select * from DATA_BRCD_KETOAN_HCM
                      ;
                      create table DATA_BRCD_KETOAN_HCM as 
select * from (select 202510 thang,a.phanvung_id,a.LOAITB_ID,a.LOAIHINH_TB,a.khoanmuctt_id, a.MA_GD, a.HDTB_ID, a.THUEBAO_ID, a.MA_TB,c.ten_kh, a.MA_LOAIHD, a.TEN_LOAIHD, a.TEN_KIEULD, a.NGAY_YC, a.NGAY_HT, a.TEN_NV, a.TEN_DV, a.PBH, a.DONVI_TT_ID, a.TEN_PB_TTVT, a.NGAY_TT, a.NGAY_HD, a.SERI, a.SOSERI, a.TIEN, a.VAT
        ,a.TIEN+a.VAT tong_ps,
         (CASE
                    WHEN 
                         ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_trong_thang,
                (CASE
                    WHEN 
                         ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_trong_thang,
                (CASE
                    WHEN 
                        ((TO_CHAR(NGAY_TT, 'YYYYMM')) = 202510  or ngay_tt is null )
                        and nvl(TENCHUQUAN,0) <> 'Phú Mỹ Hưng'
                        and trangthai = 1

                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_trong_thang
                ,
                (CASE
                    WHEN ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510 and trangthai= 1)

                    THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_thang_truoc,
                (CASE
                    WHEN ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510 and trangthai= 1)

                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_thang_truoc,
                (CASE
                    WHEN 
                        ((TO_CHAR(ngay_tt, 'YYYYMM')) <> 202510  and trangthai= 1)

                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_thang_truoc
                ,
                 (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                        THEN tien + km_lapdat
                    ELSE 0
                END) AS tien_thu_chua_thu,
                (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                    THEN vat + vat_km
                    ELSE 0
                END) AS vat_thu_chua_thu,
                (CASE
                    WHEN ((ngay_tt is null or kenhthu is null)  and trangthai = 0)or (trangthai <> 1 and ngay_tt is not null)
                    THEN vat + vat_km + tien + km_lapdat
                    ELSE 0
                END) AS tong_thu_chua_thu,
        a.KM_LAPDAT, a.VAT_KM, a.HT_TRA,  a.KENHTHU, a.TRANGTHAI_TT, a.TENCHUQUAN--, a.CHUQUAN_ID 
        from  vietanhvh.onebss_202510_new a
        left join css.v_db_thuebao@dataguard b on a.thuebao_id = b.thuebao_id and b.phanvung_id = a.phanvung_id
        left join css.v_db_khachhang@dataguard c on b.KHACHHANG_ID =c.KHACHHANG_ID  and c.phanvung_id = a.phanvung_id
        where a.phanvung_id = 28 and a.khoanmuctt_id  in (1,2,3,4,9,17,29)
                and a.tthd_id = 6 and a.dichvuvt_id in (1,4,7,8,9,10,11,12)
                and hdtb_id not in (select hdtb_id from css.v_hdtb_dungthu@dataguard
                                    where (to_char(NGAY_BD,'yyyymm'))= 202510 and trangthai <> 0 
                                            and (to_char(NGAY_CHUYEN,'yyyymm'))= 202510
                )
                )
                ;
                drop index idx_thuebao_id;
                create index idx_thuebao_id on onebss_202510_new(thuebao_id);
                select * from css.v_db_thuebao@dataguard where PHANVUNG_ID=2;